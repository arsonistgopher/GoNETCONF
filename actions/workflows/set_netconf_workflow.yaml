version: '2.0'

gonetconf.setworkflow:
      description: A simple workflow which will set netconf details and return result as JSON object.
      type: direct
      input:
        - targethost
        - transport
        - port
        - envelope
        - envelope_file
        - username
        - password
        - sshkey
        - clean_output
        - lock
        - datastore
      output:
         json_output: <% $.json_out %>
      tasks:
        set_netconf_information:
            action: gonetconf.set_netconf
            input:
              targethost: <% $.targethost %>
              transport: <% $.transport %>
              port: <% $.port %>
              envelope: <% $.envelope %>
              envelope_file: <% $.envelope_file %>
              username: <% $.username %>
              password: <% $.password %>
              sshkey: <% $.sshkey %>
              clean_output: <% $.clean_output %>
              lock:  <% $.lock %>
              datastore: <% $.datastore %>
            publish:
                xml_out: <% task(set_netconf_information).result.stdout %>
                stderr: <% task(set_netconf_information).result.stderr %>
            on-success:
               - strip_new_line_chars

        strip_new_line_chars:
            action: core.local
            input:
              cmd: echo "<% $.xml_out %>" | sed -r 's/(\\n|\\)//g'
            publish:
              xml_stripped: <% task(strip_new_line_chars).result.stdout %>
              xml_stripped_stderr: <% task(strip_new_line_chars).result.stderr %>
            on-success:
               - convert_xml_to_json

        convert_xml_to_json:
          action: xml.parse
          input:
            data: <% $.xml_stripped %>
          publish:
            json_out: <% task(convert_xml_to_json).result.stdout %>
            json_stderr: <% task(convert_xml_to_json).result.stderr %>
